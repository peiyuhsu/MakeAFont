<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Unicodeå­—å…ƒé¡¯ç¤ºå·¥å…·</title>
  <style>
    :root {
      --primary-color: #4285f4;
      --secondary-color: #34a853;
      --accent-color: #ea4335;
      --light-bg: #f8f9fa;
      --dark-bg: #202124;
      --border-color: #dadce0;
    }
    
    body {
      font-family: "Microsoft JhengHei", "PingFang TC", "Noto Sans TC", sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
      color: #333;
    }
    
    .container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .header {
      background-color: var(--primary-color);
      color: white;
      padding: 15px 20px;
      border-radius: 8px 8px 0 0;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .header h1 {
      margin: 0;
      font-size: 1.5rem;
    }
    
    .controls {
      background-color: white;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      position: sticky;
      top: 10px;
      z-index: 100;
      overflow: hidden;
    }
    
    .controls-header {
      padding: 15px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border-color);
    }
    
    .controls-header h2 {
      margin: 0;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
    }
    
    .controls-header .toggle-icon {
      transition: transform 0.3s ease;
      margin-right: 10px;
    }
    
    .controls-header .toggle-icon.collapsed {
      transform: rotate(-90deg);
    }
    
    .controls-content {
      padding: 15px;
      transition: max-height 0.3s ease;
    }
    
    .controls-content.collapsed {
      display: none;
    }
    
    .control-section {
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .control-section:last-child {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }
    
    .file-section {
      padding: 10px;
      background-color: var(--light-bg);
      border-radius: 6px;
      margin-bottom: 15px;
    }
    
    .file-section h3 {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 1rem;
    }
    
    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }
    
    button {
      padding: 8px 12px;
      border: none;
      border-radius: 4px;
      background-color: var(--primary-color);
      color: white;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background-color 0.2s;
    }
    
    button:hover {
      background-color: #3367d6;
    }
    
    button.secondary {
      background-color: var(--secondary-color);
    }
    
    button.secondary:hover {
      background-color: #2e974a;
    }
    
    .copy-btn {
      background-color: #555;
      font-size: 0.75rem;
      padding: 3px 6px;
      margin-top: 2px;
    }
    
    .copy-btn:hover {
      background-color: #333;
    }
    
    .search-filter {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .search-filter input {
      flex: 1;
      padding: 8px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 0.9rem;
    }
    
    .tabs {
      display: flex;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 15px;
      flex-wrap: wrap;
    }
    
    .tab {
      padding: 8px 15px;
      cursor: pointer;
      border: 1px solid transparent;
      border-bottom: none;
      border-radius: 4px 4px 0 0;
      margin-right: 5px;
      margin-bottom: 5px;
      background-color: #f0f0f0;
    }
    
    .tab.active {
      background-color: white;
      border-color: var(--border-color);
      margin-bottom: -1px;
      font-weight: bold;
      color: var(--primary-color);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .cell {
      background-color: white;
      border-radius: 6px;
      padding: 10px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      text-align: center;
      position: relative;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .cell:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .cell .unicode-display {
      font-size: 2rem;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      color: #333;
      background-color: #f9f9f9;
      border-radius: 4px;
    }
    
    .cell .filename {
      font-size: 0.8rem;
      color: #666;
      word-break: break-all;
      margin-bottom: 5px;
      user-select: all;
    }
    
    .cell .info {
      font-size: 0.75rem;
      color: #888;
      margin-top: 5px;
    }
    
    .status {
      padding: 10px;
      background-color: var(--light-bg);
      border-radius: 6px;
      margin-top: 15px;
      font-weight: bold;
    }
    
    .pagination {
      display: flex;
      justify-content: center;
      gap: 5px;
      margin: 15px 0;
    }
    
    .pagination button {
      min-width: 35px;
    }
    
    .loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    
    .loading-spinner {
      border: 5px solid #f3f3f3;
      border-top: 5px solid var(--primary-color);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .font-sets {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .font-set {
      padding: 8px 12px;
      background-color: var(--light-bg);
      border-radius: 20px;
      font-size: 0.9rem;
      cursor: pointer;
      border: 1px solid var(--border-color);
    }
    
    .font-set.active {
      background-color: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }
    
    .footer {
      text-align: center;
      margin-top: 30px;
      padding: 15px;
      background-color: var(--light-bg);
      border-radius: 0 0 8px 8px;
      color: #666;
      font-size: 0.8rem;
    }
    
    .quick-search {
      display: flex;
      align-items: center;
      gap: 10px;
      background-color: white;
      padding: 10px 15px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 15px;
    }
    
    .quick-search input {
      flex: 1;
      padding: 8px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 0.9rem;
    }
    
    .quick-search .status-info {
      white-space: nowrap;
      color: #666;
      font-size: 0.9rem;
    }
    
    @media (max-width: 768px) {
      .grid {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      }
      
      .quick-search {
        flex-direction: column;
        align-items: stretch;
      }
      
      .quick-search .status-info {
        white-space: normal;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>Unicodeå­—å…ƒé¡¯ç¤ºå·¥å…·</h1>
      <span id="version">V1.2</span>
    </div>
    
    <div class="controls">
      <div class="controls-header" id="controlsToggle">
        <h2>
          <span class="toggle-icon">â–¼</span>
          æ“ä½œé¢æ¿
        </h2>
        <div id="headerStatus">è«‹é¸æ“‡å­—å…ƒåˆ—è¡¨æª”æ¡ˆ</div>
      </div>
      <div class="controls-content" id="controlsContent">
        <div class="control-section">
          <div class="file-section">
            <h3>å­—å…ƒåˆ—è¡¨æª”æ¡ˆ</h3>
            <input type="file" id="charListFile" multiple />
            <div id="listCount"></div>
          </div>
        </div>
        
        <div class="control-section">
          <div class="font-sets" id="fontSets">
            <!-- å­—é«”é›†åˆå°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
          </div>
          
          <div class="tabs" id="tabs">
            <div class="tab active" data-tab="all">å…¨éƒ¨å­—å…ƒ</div>
            <!-- å…¶ä»–é ç±¤å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
          </div>
        </div>
        
        <div class="control-section">
          <div class="search-filter">
            <input type="text" id="searchInput" placeholder="æœå°‹å­—å…ƒã€æª”åæˆ–Unicode..." />
            <button id="clearSearch">æ¸…é™¤</button>
          </div>
          
          <div class="button-group">
            <button id="exportJsonBtn">åŒ¯å‡ºJSON</button>
          </div>
        </div>
        
        <div id="statusMessage" class="status">è«‹é¸æ“‡å­—å…ƒåˆ—è¡¨æª”æ¡ˆ</div>
      </div>
    </div>
    
    <div class="quick-search">
      <input type="text" id="quickSearchInput" placeholder="å¿«é€Ÿæœå°‹..." />
      <button id="quickClearSearch">æ¸…é™¤</button>
      <div class="status-info" id="quickStatus"></div>
    </div>
    
    <div id="pagination" class="pagination"></div>
    
    <div class="tab-content active" id="all-content">
      <div class="grid" id="allGrid"></div>
    </div>
    
    <!-- å…¶ä»–é ç±¤å…§å®¹å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
  </div>
  
  <div class="footer">
    Â© 2025 Unicodeå­—å…ƒé¡¯ç¤ºå·¥å…·
  </div>
  
  <div id="loading" class="loading" style="display: none;">
    <div class="loading-spinner"></div>
  </div>

  <script>
    // å…¨å±€è®Šé‡
    let charSets = {};
    let charData = [];
    let currentFontSet = 'all';
    let currentPage = 1;
    let itemsPerPage = 100;
    let filteredChars = [];
    let searchTerm = '';
    let fileListMap = new Map(); // å„²å­˜æª”æ¡ˆåˆ—è¡¨çš„æ˜ å°„
    let controlsExpanded = true; // æ§åˆ¶é¢æ¿é è¨­å±•é–‹

    // åˆå§‹åŒ–é é¢
    document.addEventListener('DOMContentLoaded', function() {
      // è¨­ç½®æ§åˆ¶é¢æ¿æŠ˜ç–Š/å±•é–‹åŠŸèƒ½
      setupCollapsibleControls();
      
      // äº‹ä»¶ç›£è½å™¨è¨­ç½®
      document.getElementById('charListFile').addEventListener('change', handleCharListFilesChange);
      document.getElementById('searchInput').addEventListener('input', handleSearch);
      document.getElementById('clearSearch').addEventListener('click', clearSearch);
      document.getElementById('quickSearchInput').addEventListener('input', handleQuickSearch);
      document.getElementById('quickClearSearch').addEventListener('click', clearQuickSearch);
      document.getElementById('exportJsonBtn').addEventListener('click', exportJson);
      
      // é ç±¤åˆ‡æ›äº‹ä»¶
      document.getElementById('tabs').addEventListener('click', function(e) {
        if (e.target.classList.contains('tab')) {
          switchTab(e.target.dataset.tab);
        }
      });
      
      // è¨­ç½®åˆå§‹ç‹€æ…‹
      updateStatus('è«‹é¸æ“‡å­—å…ƒåˆ—è¡¨æª”æ¡ˆ');
    });

    // è¨­ç½®å¯æ”¶ç¸®æ§åˆ¶é¢æ¿
    function setupCollapsibleControls() {
      const toggleBtn = document.getElementById('controlsToggle');
      const contentDiv = document.getElementById('controlsContent');
      const toggleIcon = document.querySelector('.toggle-icon');
      
      // åˆå§‹ç‹€æ…‹ï¼šå±•é–‹
      toggleIcon.classList.remove('collapsed');
      contentDiv.classList.remove('collapsed');
      
      toggleBtn.addEventListener('click', function() {
        controlsExpanded = !controlsExpanded;
        
        if (controlsExpanded) {
          // å±•é–‹
          toggleIcon.classList.remove('collapsed');
          contentDiv.classList.remove('collapsed');
        } else {
          // æ”¶ç¸®
          toggleIcon.classList.add('collapsed');
          contentDiv.classList.add('collapsed');
        }
      });
    }

    // è™•ç†å­—å…ƒåˆ—è¡¨æ–‡ä»¶é¸æ“‡
    function handleCharListFilesChange(e) {
      const files = Array.from(e.target.files);
      
      if (files.length === 0) {
        updateStatus('âš ï¸ æœªé¸æ“‡å­—å…ƒåˆ—è¡¨æª”æ¡ˆ');
        return;
      }
      
      showLoading();
      
      // æ¸…ç©ºä¹‹å‰çš„å­—ç¬¦é›†
      charSets = {};
      fileListMap.clear();
      charData = [];
      
      let loadedCount = 0;
      
      files.forEach(file => {
        const reader = new FileReader();
        const setName = file.name.replace(/\.[^/.]+$/, ''); // ç§»é™¤å‰¯æª”å
        
        reader.onload = function(event) {
          const content = event.target.result;
          const lines = content.split(/\r?\n/).filter(Boolean);
          charSets[setName] = [];
          
          lines.forEach(line => {
            let unicode = line.trim();
            let char = '';
            let filename = '';
            
            // è™•ç†ä¸åŒæ ¼å¼çš„Unicodeç·¨ç¢¼
            if (unicode.startsWith('uni')) {
              try {
                const codePoint = parseInt(unicode.slice(3), 16);
                char = String.fromCodePoint(codePoint);
                filename = `${unicode}.png`;
              } catch (e) {
                console.error('ç„¡æ³•è§£æUnicode:', unicode, e);
              }
            } else if (unicode.startsWith('U+')) {
              try {
                const codePoint = parseInt(unicode.slice(2), 16);
                char = String.fromCodePoint(codePoint);
                filename = `uni${unicode.slice(2)}.png`;
              } catch (e) {
                console.error('ç„¡æ³•è§£æUnicode:', unicode, e);
              }
            } else if (unicode.startsWith('u')) {
              // è™•ç†å½¢å¦‚u217DAçš„æ ¼å¼
              try {
                const codePoint = parseInt(unicode.slice(1), 16);
                char = String.fromCodePoint(codePoint);
                filename = `uni${unicode.slice(1)}.png`;
              } catch (e) {
                console.error('ç„¡æ³•è§£æUnicode:', unicode, e);
              }
            } else if (/^[A-Za-z]+$/.test(unicode)) {
              // è™•ç†å­—æ¯åç¨±æ ¼å¼ï¼Œå¦‚Agrave
              // æ­¤è™•ç°¡åŒ–è™•ç†ï¼Œå¯¦éš›å¯èƒ½éœ€è¦æŸ¥è©¢æ˜ å°„è¡¨
              filename = `${unicode}.png`;
            }
            
            if (filename) {
              const charInfo = {
                char,
                unicode,
                filename,
                setName
              };
              
              charSets[setName].push(charInfo);
              charData.push(charInfo);
            }
          });
          
          loadedCount++;
          if (loadedCount === files.length) {
            // æ‰€æœ‰æª”æ¡ˆéƒ½å·²è¼‰å…¥
            document.getElementById('listCount').textContent = `å·²è¼‰å…¥ ${files.length} å€‹å­—å…ƒåˆ—è¡¨ï¼Œå…± ${charData.length} å€‹å­—å…ƒ`;
            
            // å‰µå»ºå­—é«”é›†æ¨™ç±¤
            createFontSetTabs();
            
            // åˆå§‹åŒ–é¡¯ç¤º
            filteredChars = [...charData];
            renderPagination();
            renderGrid();
            
            const statusMsg = `å·²è¼‰å…¥ ${files.length} å€‹å­—å…ƒåˆ—è¡¨æª”æ¡ˆï¼Œå…± ${charData.length} å€‹å­—å…ƒ`;
            updateStatus(statusMsg);
            updateHeaderStatus(statusMsg);
            updateQuickStatus(`å…± ${charData.length} å€‹å­—å…ƒ`);
            
            // å¦‚æœæ§åˆ¶é¢æ¿æ˜¯å±•é–‹çš„ï¼Œå¯ä»¥é¸æ“‡è‡ªå‹•æ”¶åˆ
            // if (controlsExpanded) {
            //   document.getElementById('controlsToggle').click();
            // }
            
            hideLoading();
          }
        };
        
        reader.onerror = function() {
          console.error(`ç„¡æ³•è®€å–æª”æ¡ˆ ${file.name}`);
          loadedCount++;
          if (loadedCount === files.length) {
            hideLoading();
          }
        };
        
        reader.readAsText(file, 'UTF-8');
      });
    }

    // å‰µå»ºå­—é«”é›†æ¨™ç±¤
    function createFontSetTabs() {
      const fontSetsContainer = document.getElementById('fontSets');
      const tabsContainer = document.getElementById('tabs');
      
      // æ¸…ç©ºç¾æœ‰å…§å®¹
      fontSetsContainer.innerHTML = `<div class="font-set active" data-set="all">å…¨éƒ¨</div>`;
      
      // ä¿ç•™ç¬¬ä¸€å€‹ã€Œå…¨éƒ¨å­—å…ƒã€é ç±¤
      const allTab = tabsContainer.querySelector('[data-tab="all"]');
      tabsContainer.innerHTML = '';
      tabsContainer.appendChild(allTab);
      
      // æ¸…ç©ºé™¤ã€Œall-contentã€å¤–çš„æ‰€æœ‰å…§å®¹
      document.querySelectorAll('.tab-content:not(#all-content)').forEach(el => el.remove());
      
      // ç‚ºæ¯å€‹å­—é«”é›†å‰µå»ºæ¨™ç±¤å’Œé ç±¤
      Object.keys(charSets).forEach((setName, index) => {
        // å‰µå»ºå­—é«”é›†é¸æ“‡å™¨
        const setDiv = document.createElement('div');
        setDiv.className = 'font-set';
        setDiv.dataset.set = setName;
        setDiv.textContent = setName;
        setDiv.addEventListener('click', () => switchFontSet(setName));
        fontSetsContainer.appendChild(setDiv);
        
        // å‰µå»ºé ç±¤
        const tab = document.createElement('div');
        tab.className = 'tab';
        tab.dataset.tab = setName;
        tab.textContent = setName;
        tabsContainer.appendChild(tab);
        
        // å‰µå»ºé ç±¤å…§å®¹
        const content = document.createElement('div');
        content.className = 'tab-content';
        content.id = `${setName}-content`;
        
        const grid = document.createElement('div');
        grid.className = 'grid';
        grid.id = `${setName}Grid`;
        
        content.appendChild(grid);
        document.querySelector('.container').insertBefore(content, document.getElementById('pagination').nextSibling);
      });
      
      // ç‚ºå­—é«”é›†æ·»åŠ é»æ“Šäº‹ä»¶
      document.querySelectorAll('.font-set').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.font-set').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          
          currentFontSet = this.dataset.set;
          filterAndRenderChars();
        });
      });
    }

    // åˆ‡æ›é ç±¤
    function switchTab(tabId) {
      // æ›´æ–°é ç±¤ç‹€æ…‹
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.toggle('active', tab.dataset.tab === tabId);
      });
      
      // æ›´æ–°å…§å®¹é¡¯ç¤º
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.toggle('active', content.id === `${tabId}-content`);
      });
      
      // æ›´æ–°ç•¶å‰å­—é«”é›†
      currentFontSet = tabId;
      filterAndRenderChars();
    }

    // åˆ‡æ›å­—é«”é›†
    function switchFontSet(setName) {
      document.querySelectorAll('.font-set').forEach(set => {
        set.classList.toggle('active', set.dataset.set === setName);
      });
      
      currentFontSet = setName;
      filterAndRenderChars();
      
      // åŒæ™‚åˆ‡æ›åˆ°å°æ‡‰é ç±¤
      switchTab(setName);
    }

    // éæ¿¾ä¸¦æ¸²æŸ“å­—å…ƒ
    function filterAndRenderChars() {
      showLoading();
      
      setTimeout(() => {
        if (!charData || charData.length === 0) {
          hideLoading();
          return;
        }
        
        // æ ¹æ“šå­—é«”é›†å’Œæœå°‹æ¢ä»¶éæ¿¾
        if (currentFontSet === 'all') {
          // å…¨éƒ¨é¡¯ç¤ºï¼Œåƒ…éæ¿¾æœå°‹è©
          filteredChars = charData.filter(item => {
            if (!searchTerm) return true;
            return item.filename.toLowerCase().includes(searchTerm.toLowerCase()) || 
                  (item.char && item.char.includes(searchTerm)) ||
                  item.unicode.toLowerCase().includes(searchTerm.toLowerCase());
          });
        } else {
          // éæ¿¾æŒ‡å®šå­—é«”é›†
          filteredChars = charSets[currentFontSet] || [];
          
          // å¦‚æœæœ‰æœå°‹è©ï¼Œç¹¼çºŒéæ¿¾
          if (searchTerm) {
            filteredChars = filteredChars.filter(item => 
              item.filename.toLowerCase().includes(searchTerm.toLowerCase()) || 
              (item.char && item.char.includes(searchTerm)) ||
              item.unicode.toLowerCase().includes(searchTerm.toLowerCase())
            );
          }
        }
        
        currentPage = 1;
        renderPagination();
        renderGrid();
        
        const statusMsg = `ç•¶å‰é¡¯ç¤º: ${filteredChars.length} / ${charData.length} å€‹å­—å…ƒ (${currentFontSet})`;
        updateStatus(statusMsg);
        updateQuickStatus(`${filteredChars.length} / ${charData.length} å€‹å­—å…ƒ`);
        hideLoading();
      }, 100);
    }

    // è™•ç†æœå°‹
    function handleSearch() {
      searchTerm = document.getElementById('searchInput').value.trim();
      // åŒæ­¥æ›´æ–°å¿«é€Ÿæœå°‹æ¡†
      document.getElementById('quickSearchInput').value = searchTerm;
      filterAndRenderChars();
    }

    // è™•ç†å¿«é€Ÿæœå°‹
    function handleQuickSearch() {
      searchTerm = document.getElementById('quickSearchInput').value.trim();
      // åŒæ­¥æ›´æ–°ä¸»æœå°‹æ¡†
      document.getElementById('searchInput').value = searchTerm;
      filterAndRenderChars();
    }

    // æ¸…é™¤æœå°‹
    function clearSearch() {
      document.getElementById('searchInput').value = '';
      document.getElementById('quickSearchInput').value = '';
      searchTerm = '';
      filterAndRenderChars();
    }

    // æ¸…é™¤å¿«é€Ÿæœå°‹
    function clearQuickSearch() {
      document.getElementById('quickSearchInput').value = '';
      document.getElementById('searchInput').value = '';
      searchTerm = '';
      filterAndRenderChars();
    }

    // åŒ¯å‡ºJSON
    function exportJson() {
      if (charData.length === 0) {
        updateStatus('âš ï¸ æ²’æœ‰å¯åŒ¯å‡ºçš„è³‡æ–™');
        return;
      }
      
      showLoading();
      
      setTimeout(() => {
        // å»ºç«‹ä¸¦ä¸‹è¼‰JSONæ–‡ä»¶
        const blob = new Blob([JSON.stringify(filteredChars, null, 2)], { type: 'application/json' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `unicode_chars_${new Date().toISOString().slice(0, 10)}.json`;
        a.click();
        
        updateStatus(`ğŸ’¾ å·²åŒ¯å‡º ${filteredChars.length} å€‹å­—å…ƒè³‡æ–™`);
        hideLoading();
      }, 100);
    }
    
    // æ¸²æŸ“åˆ†é æ§åˆ¶
    function renderPagination() {
      if (!filteredChars || filteredChars.length === 0) return;
      
      const totalPages = Math.ceil(filteredChars.length / itemsPerPage);
      const paginationElem = document.getElementById('pagination');
      paginationElem.innerHTML = '';
      
      // å¦‚æœåªæœ‰ä¸€é ï¼Œä¸é¡¯ç¤ºåˆ†é 
      if (totalPages <= 1) return;
      
      // ä¸Šä¸€é æŒ‰éˆ•
      const prevBtn = document.createElement('button');
      prevBtn.textContent = 'ä¸Šä¸€é ';
      prevBtn.disabled = currentPage === 1;
      prevBtn.addEventListener('click', () => {
        if (currentPage > 1) {
          currentPage--;
          renderGrid();
        }
      });
      paginationElem.appendChild(prevBtn);
      
      // é ç¢¼æŒ‰éˆ•
      const maxButtons = 7; // æœ€å¤šé¡¯ç¤ºçš„é ç¢¼æ•¸é‡
      let startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
      let endPage = Math.min(totalPages, startPage + maxButtons - 1);
      
      if (endPage - startPage + 1 < maxButtons) {
        startPage = Math.max(1, endPage - maxButtons + 1);
      }
      
      for (let i = startPage; i <= endPage; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.textContent = i;
        pageBtn.classList.toggle('active', i === currentPage);
        pageBtn.addEventListener('click', () => {
          currentPage = i;
          renderGrid();
        });
        paginationElem.appendChild(pageBtn);
      }
      
      // ä¸‹ä¸€é æŒ‰éˆ•
      const nextBtn = document.createElement('button');
      nextBtn.textContent = 'ä¸‹ä¸€é ';
      nextBtn.disabled = currentPage === totalPages;
      nextBtn.addEventListener('click', () => {
        if (currentPage < totalPages) {
          currentPage++;
          renderGrid();
        }
      });
      paginationElem.appendChild(nextBtn);
      
      // é æ•¸è³‡è¨Š
      const pageInfo = document.createElement('span');
      pageInfo.textContent = ` ${currentPage}/${totalPages} é `;
      pageInfo.style.margin = '0 10px';
      paginationElem.appendChild(pageInfo);
    }
    
    // æ¸²æŸ“å­—å…ƒç¶²æ ¼
    function renderGrid() {
      if (!filteredChars || filteredChars.length === 0) return;
      
      // æ ¹æ“šç•¶å‰é ç¢¼è¨ˆç®—è¦é¡¯ç¤ºçš„å­—å…ƒ
      const start = (currentPage - 1) * itemsPerPage;
      const end = Math.min(start + itemsPerPage, filteredChars.length);
      const pageChars = filteredChars.slice(start, end);
      
      // æ¸…ç©ºæ‰€æœ‰ç¶²æ ¼
      document.querySelectorAll('.grid').forEach(grid => {
        grid.innerHTML = '';
      });
      
      // ç²å–ç›¸æ‡‰çš„ç¶²æ ¼å…ƒç´ 
      let gridElem;
      if (currentFontSet === 'all') {
        gridElem = document.getElementById('allGrid');
      } else {
        gridElem = document.getElementById(`${currentFontSet}Grid`);
      }
      
      if (!gridElem) return;
      
      // å‰µå»ºå–®å…ƒæ ¼
      pageChars.forEach(charInfo => {
        const cell = createCell(charInfo);
        gridElem.appendChild(cell);
      });
      
      // æ›´æ–°åˆ†é 
      renderPagination();
      
      // æ›´æ–°ç‹€æ…‹
      const statusMsg = `é¡¯ç¤º ${start + 1} - ${end} å€‹å­—å…ƒ (å…± ${filteredChars.length} å€‹)`;
      updateStatus(statusMsg);
      updateQuickStatus(`${start + 1}-${end}/${filteredChars.length}`);
    }
    
    // å‰µå»ºå–®å…ƒæ ¼
    function createCell(charInfo) {
      const cell = document.createElement('div');
      cell.className = 'cell';
      
      // Unicodeé¡¯ç¤ºå€åŸŸ
      const unicodeDisplay = document.createElement('div');
      unicodeDisplay.className = 'unicode-display';
      
      if (charInfo.char) {
        unicodeDisplay.textContent = charInfo.char;
      } else {
        unicodeDisplay.textContent = 'ï¿½';
        unicodeDisplay.style.color = '#999';
      }
      
      // Unicodeç·¨ç¢¼é¡¯ç¤º
      const unicodeCode = document.createElement('div');
      unicodeCode.className = 'info';
      unicodeCode.textContent = charInfo.unicode;
      
      // æª”åé¡¯ç¤ºå€åŸŸ
      const filename = document.createElement('div');
      filename.className = 'filename';
      filename.textContent = charInfo.filename;
      
      // è¤‡è£½æŒ‰éˆ•
      const copyBtn = document.createElement('button');
      copyBtn.className = 'copy-btn';
      copyBtn.textContent = 'è¤‡è£½æª”å';
      copyBtn.addEventListener('click', () => {
        navigator.clipboard.writeText(charInfo.filename).then(() => {
          copyBtn.textContent = 'å·²è¤‡è£½!';
          setTimeout(() => {
            copyBtn.textContent = 'è¤‡è£½æª”å';
          }, 1500);
        });
      });
      
      // å­—é›†è³‡è¨Š
      const setInfo = document.createElement('div');
      setInfo.className = 'info';
      setInfo.textContent = `å­—é›†: ${charInfo.setName}`;
      
      // å°‡æ‰€æœ‰å…ƒç´ æ·»åŠ åˆ°å–®å…ƒæ ¼
      cell.appendChild(unicodeDisplay);
      cell.appendChild(unicodeCode);
      cell.appendChild(filename);
      cell.appendChild(copyBtn);
      cell.appendChild(setInfo);
      
      return cell;
    }
    
    // æ›´æ–°ç‹€æ…‹è¨Šæ¯
    function updateStatus(message) {
      document.getElementById('statusMessage').textContent = message;
    }
    
    // æ›´æ–°é ‚éƒ¨ç‹€æ…‹è¨Šæ¯
    function updateHeaderStatus(message) {
      document.getElementById('headerStatus').textContent = message;
    }
    
    // æ›´æ–°å¿«é€Ÿæœå°‹å€åŸŸçš„ç‹€æ…‹è¨Šæ¯
    function updateQuickStatus(message) {
      document.getElementById('quickStatus').textContent = message;
    }
    
    // é¡¯ç¤ºè¼‰å…¥ä¸­
    function showLoading() {
      document.getElementById('loading').style.display = 'flex';
    }
    
    // éš±è—è¼‰å…¥ä¸­
    function hideLoading() {
      document.getElementById('loading').style.display = 'none';
    }
  </script>
</body>
</html>